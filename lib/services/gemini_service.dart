import 'package:google_generative_ai/google_generative_ai.dart';

class GeminiService {
  // 1. ì—¬ê¸°ì— ì§ì ‘ ë°œê¸‰ë°›ìœ¼ì‹  API í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  final String _apiKey = 'Gemini API';

  Future<String> getRecommendations(List<String> emotions) async {
    // 2. ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ë˜ ë¶ˆí•„ìš”í•œ 'if' ë¬¸ì„ ì™„ì „íˆ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.
    //    ì´ì œ ì´ ì½”ë“œëŠ” í•­ìƒ APIë¥¼ í˜¸ì¶œí•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.

    // 3. ì˜¬ë°”ë¥¸ ëª¨ë¸ ì´ë¦„ì¸ 'gemini-1.0-pro-latest'ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    final model = GenerativeModel(model: 'gemini-2.5-flash', apiKey: _apiKey);

    final prompt =
        '''
      ì‚¬ìš©ìì˜ ì‚¬ì§„ì—ì„œ ì£¼ë¡œ '${emotions.join(', ')}'ì™€ ê°™ì€ ê°ì •ì´ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤.
      ì´ ê°ì •ë“¤ì— ì–´ìš¸ë¦¬ëŠ” ì•„ë˜ í•­ëª©ë“¤ì„ ê°ê° 2~3ê°€ì§€ì”© ì¶”ì²œí•´ì£¼ì„¸ìš”.
      ê²°ê³¼ëŠ” ì•„ë˜ í˜•ì‹ì— ë§ì¶° ê°„ê²°í•œ ë§ˆí¬ë‹¤ìš´ ë¦¬ìŠ¤íŠ¸ë¡œ, ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ë‹µí•´ì£¼ì„¸ìš”.

      ### ğŸƒ ì¶”ì²œ í™œë™
      - í™œë™ 1
      - í™œë™ 2

      ### ğŸ¬ ì¶”ì²œ ì˜í™”/ë“œë¼ë§ˆ
      - ì˜í™”/ë“œë¼ë§ˆ 1
      - ì˜í™”/ë“œë¼ë§ˆ 2

      ### ğŸµ ì¶”ì²œ ìŒì•…
      - ìŒì•… 1
      - ìŒì•… 2
    ''';

    try {
      final content = [Content.text(prompt)];
      final response = await model.generateContent(content);
      return response.text ?? "ì¶”ì²œ ë‚´ìš©ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
    } catch (e) {
      // 4. ì˜¤ë¥˜ ë°œìƒ ì‹œ, ì½˜ì†”ì— ì •í™•í•œ ì›ì¸ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
      print(">>> ìµœì¢… Gemini API ì˜¤ë¥˜: $e");
      return "ì¶”ì²œì„ ë°›ì•„ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
    }
  }
}
